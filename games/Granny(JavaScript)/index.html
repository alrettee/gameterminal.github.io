<html lang="en-us">
<head>
    <title>Granny Original</title>
    <meta charset="utf-8">
    <meta name="robots" content="noindex, nofollow">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/bubbls/granny@212c543a85b243c4a0b92211f557e760d83d2292/TemplateData/style.css">
    <script src="https://cdn.jsdelivr.net/gh/bubbls/granny@212c543a85b243c4a0b92211f557e760d83d2292/sdk.js"></script>

    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: url('https://cdn.jsdelivr.net/gh/gru6nny/ohd@main/background.png') no-repeat center center fixed;
            background-size: cover;
        }
        #unity-container { position: absolute; width: 100%; height: 100%; left: 0; top: 0; }

        /* Loading bar */
        #unity-loading-bar {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 400px;
            height: 20px;
            background: rgba(0,0,0,0.5);
            border: 2px solid #fff;
            border-radius: 10px;
            display: block;
            opacity: 1;               /* start fully visible */
            transition: opacity 1s ease; /* smooth fade */
        }
        #unity-logo { position: absolute; top: calc(50% - 100px); left: 50%; transform: translateX(-50%); width: 200px; height: auto; }
        #unity-progress-bar-empty { width: 100%; height: 100%; position: relative; }
        #unity-progress-bar-full { position: absolute; top: 0; left: 0; width: 0%; height: 100%; background: #4caf50; border-radius: 8px; transition: width 0.3s ease; }
        #unity-warning { position: absolute; left: 50%; top: 5%; transform: translate(-50%); background: white; padding: 10px; display: none; border: 1px solid #ccc; border-radius: 5px; }

        /* Mobile Controls */
        #mobile-controls { position: fixed; width: 100%; height: 100%; pointer-events: none; z-index: 10000; }
        #joystick-container { position: absolute; bottom: 20px; left: 20px; width: 100px; height: 100px; background: rgba(0,255,0,0.2); border-radius: 50%; display: none; pointer-events: all; }
        #joystick { width: 50px; height: 50px; background: rgba(0,255,0,0.5); border-radius: 50%; margin: 25px; touch-action: none; }
        #action-buttons { position: absolute; top: 20px; right: 20px; display: none; pointer-events: all; }
        #action-buttons button { display: block; margin-bottom: 10px; width: 60px; height: 60px; font-size: 18px; border-radius: 10px; background: rgba(0,255,0,0.5); border: 1px solid #0f0; color: #000; }
        #btn-drop { position: absolute; bottom: 20px; right: 50%; transform: translateX(50%); width: 80px; height: 50px; font-size: 16px; border-radius: 10px; background: rgba(0,255,0,0.5); border: 1px solid #0f0; color: #000; display: none; pointer-events: all; }
    </style>
</head>
<body>
    <div id="unity-container">
        <canvas id="unity-canvas" style="position: absolute; width: 100%; height: 100%"></canvas>
        <div id="unity-loading-bar">
            <div id="unity-logo"></div>
            <div id="unity-progress-bar-empty">
                <div id="unity-progress-bar-full"></div>
            </div>
        </div>
        <div id="unity-warning"></div>
    </div>

    <!-- Mobile Controls -->
    <div id="mobile-controls">
        <div id="joystick-container">
            <div id="joystick"></div>
        </div>
        <div id="action-buttons">
            <button id="btn-e">E</button>
            <button id="btn-hide">Hide</button>
        </div>
        <button id="btn-drop">DROP</button>
    </div>

    <!-- GameMonetize SDK -->
    <script type="text/javascript">
        window.SDK_OPTIONS = {
            gameId: "jp112o3o4hzgrnc7zaewjkrfk282pul8",
            onEvent: function(a){
                switch(a.name){
                    case "SDK_GAME_PAUSE":
                        if(typeof myGameInstance!=='undefined' && myGameInstance){
                            myGameInstance.SendMessage('AudioManager','MuteAudio');
                        }
                        break;
                    case "SDK_GAME_START":
                        if(typeof myGameInstance!=='undefined' && myGameInstance){
                            myGameInstance.SendMessage('AudioManager','UnmuteAudio');
                        }
                        break;
                }
            }
        };
        (function(a,b,c){
            var d=a.getElementsByTagName(b)[0];
            a.getElementById(c) || (a=a.createElement(b),a.id=c,a.src="https://cdn.jsdelivr.net/gh/testamalame/sef@main/sedk.js",d.parentNode.insertBefore(a,d));
        })(document,"script","gamemonetize-sdk");
    </script>

    <script>
        let myGameInstance = null;
        const canvas = document.getElementById("unity-canvas");
        const progressBarFull = document.getElementById("unity-progress-bar-full");

        async function mergeUnityWebFiles(baseUrl, filePrefix, totalParts, extension){
            const partUrls=[];
            for(let i=1;i<=totalParts;i++) partUrls.push(`${baseUrl}/${filePrefix}_part${i}.${extension}`);
            const buffers=[];
            for(let i=0;i<totalParts;i++){
                const response = await fetch(partUrls[i]);
                const buffer = await response.arrayBuffer();
                buffers.push(buffer);
                progressBarFull.style.width = `${((i+1)/totalParts)*100}%`;
            }
            const totalLength = buffers.reduce((acc,b)=>acc+b.byteLength,0);
            const combined = new Uint8Array(totalLength);
            let offset=0;
            buffers.forEach(b=>{combined.set(new Uint8Array(b),offset);offset+=b.byteLength;});
            return combined;
        }

        const buildUrl = "https://cdn.jsdelivr.net/gh/gru6nny/ohd@main/Build";
        const loaderUrl = buildUrl+"/Granny.loader.js";

        async function initializeGame(){
            const dataBuffer = await mergeUnityWebFiles(buildUrl,"Granny",2,"data");
            const wasmBuffer = await mergeUnityWebFiles(buildUrl,"Granny",2,"wasm");
            const dataBlobUrl = URL.createObjectURL(new Blob([dataBuffer],{type:"application/octet-stream"}));
            const wasmBlobUrl = URL.createObjectURL(new Blob([wasmBuffer],{type:"application/octet-stream"}));

            const config = {
                dataUrl:dataBlobUrl,
                frameworkUrl:buildUrl+"/Granny.framework.js",
                codeUrl:wasmBlobUrl,
                streamingAssetsUrl:"https://cdn.jsdelivr.net/gh/gru6nny/ohd@main/StreamingAssets",
                companyName:"Anastasia Kazantseva",
                productName:"Granny",
                productVersion:"1.0"
            };

            const script=document.createElement("script");
            script.src=loaderUrl;
            script.onload=()=>{
                createUnityInstance(canvas, config, (progress)=>{
                    progressBarFull.style.width = 100*progress+"%";
                }).then(instance=>{
                    myGameInstance = instance;

                    // Fade out loading bar smoothly
                    const loadingBar = document.getElementById("unity-loading-bar");
                    loadingBar.style.opacity = "0";
                    setTimeout(()=>{loadingBar.style.display="none";}, 1000);

                    canvas.addEventListener('pointerdown',()=>{
                        if(typeof sdk!=='undefined' && sdk.showBanner) sdk.showBanner();
                    });
                });
            };
            document.body.appendChild(script);
        }
        initializeGame();
    </script>

    <script>
        window.addEventListener("load", ()=>{
            const isMobile = /Mobi|Android/i.test(navigator.userAgent);
            if(!isMobile) return;

            const joystickContainer = document.getElementById("joystick-container");
            const joystick = document.getElementById("joystick");
            const actionButtons = document.getElementById("action-buttons");
            const btnDrop = document.getElementById("btn-drop");

            joystickContainer.style.display = "block";
            actionButtons.style.display = "block";
            btnDrop.style.display = "block";

            let startX,startY;
            let keysPressed = {};

            joystick.addEventListener("touchstart", e=>{
                const touch = e.touches[0];
                startX = touch.clientX;
                startY = touch.clientY;
            });

            joystick.addEventListener("touchmove", e=>{
                const touch = e.touches[0];
                const dx = touch.clientX - startX;
                const dy = touch.clientY - startY;

                keysPressed = {};
                if(dy<-20) keysPressed['w']=true;
                if(dy>20) keysPressed['s']=true;
                if(dx<-20) keysPressed['a']=true;
                if(dx>20) keysPressed['d']=true;

                Object.keys(keysPressed).forEach(k=>{
                    document.dispatchEvent(new KeyboardEvent("keydown",{key:k}));
                });
            });

            joystick.addEventListener("touchend", e=>{
                Object.keys(keysPressed).forEach(k=>{
                    document.dispatchEvent(new KeyboardEvent("keyup",{key:k}));
                });
                keysPressed={};
            });

            function bindButton(id,key){
                const btn = document.getElementById(id);
                btn.addEventListener("touchstart", ()=>document.dispatchEvent(new KeyboardEvent("keydown",{key:key})));
                btn.addEventListener("touchend", ()=>document.dispatchEvent(new KeyboardEvent("keyup",{key:key})));
            }

            bindButton("btn-e","e");
            bindButton("btn-hide","h");
            bindButton("btn-drop"," ");
        });
    </script>
</body>
</html>
